$('form#new_operation').get(0).setAttribute("action", "/operations/<%= @operation.id %>");
$('form#new_operation > div').append('<input name="_method" type="hidden" value="put">');
$('.playlist-container').replaceWith("<%= escape_javascript render 'basic_infos/all_added_operations', :user=>@user %>");
$('.playlist li a.video').removeClass('active');
$('.playlist li').removeClass('selected');
$('.playlist li a.video').eq(<%= @operation.position - 1 %>).addClass('active');
$('.playlist li').eq(<%= @operation.position - 1 %>).addClass('selected');
$('input#submit_operation_info').removeAttr('disabled');
$('input#submit_operation_info').get(0).setAttribute('value', '更新手术/外伤信息');
$(document).ready(function() {
  var createVideoForm;
  createVideoForm = $("form#create-video-uploader");
  if (createVideoForm.length > 0) {
    createVideoForm.QiniuUploader({
      autoUpload: true,
      removeProgressBarWhenCompleted: true,
      onFilesAdd: function(file) {
        types = /(\.|\/)(docx|doc|mov|mp4|jpg|png)$/i;
        if (types.test(file.type) || types.test(file.name)) {
          if (file.size > 100000000) {
            alert("上传失败：" + file.name + " 附件太大，超过100M");
            return false;
          } else {
            return true;
          }
        } else {
          alert("上传失败：" + file.name + " 附件格式错误，请上传mov或mp4文件");
          return false;
        }
      }
    });
    createVideoForm.bind("qiniu_upload_start", function(e) {
      $('#submit_operation_info').attr('value', '附件正在上传');
      $('#submit_operation_info').attr('disabled', 'true');
      $('a.fileupload-btn').bind('click', false);
    });
    createVideoForm.bind("qiniu_upload_complete", function(e, data) {
      $('#progress-text').html("附件上传成功！");
      $('#video-filename').html("附件文件名： " + "<strong>" + data.fname + "</strong>");
    });
  }
});
